package com.apollo.hexagonal.adapters.out.repository.entity

import com.amazonaws.services.dynamodbv2.datamodeling.*
import com.apollo.hexagonal.adapters.out.repository.mapper.AddressEntityMapper
import com.apollo.hexagonal.application.core.domain.Customer

@DynamoDBTable(tableName = "tb_customer")
data class CustomerEntity(
    @DynamoDBHashKey
    @DynamoDBAutoGeneratedKey
    var id: String? = null,

    @DynamoDBAttribute
    var name: String = "",

    @DynamoDBTypeConverted(converter = AddressEntityMapper::class)
    @DynamoDBAttribute
    var address: AddressEntity? = null,

    @DynamoDBAttribute
    var cpf: String = "",

    @DynamoDBAttribute
    var isValidCpf: Boolean = false
) {
    constructor(customer: Customer) : this(
        customer.id,
        customer.name,
        customer.address?.let { AddressEntity(it) },
        customer.cpf,
        customer.isValidCpf
    )

    fun toCustomer() = Customer(id, name, address?.toAddress(), cpf, isValidCpf)
}